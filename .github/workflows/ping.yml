name: Render Wake-up Service
on:
  schedule:
    - cron: '*/5 * * * *'  # –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  workflow_dispatch:

jobs:
  wake-render:
    runs-on: ubuntu-latest
    timeout-minutes: 5      # –ú–∞–∫—Å–∏–º—É–º 5 –º–∏–Ω—É—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    steps:
    - name: Wake up Render with patience
      run: |
        echo "üïê –ù–∞—á–∏–Ω–∞–µ–º –±—É–¥–∏—Ç—å Render..."
        echo "‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞: $(date)"
        
        # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
        for attempt in {1..6}; do
          echo "üîî –ü–æ–ø—ã—Ç–∫–∞ $attempt –∏–∑ 6..."
          
          # –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º 30 —Å–µ–∫—É–Ω–¥
          response_code=$(curl -s \
            -o /dev/null \
            -w "%{http_code}" \
            --max-time 30 \
            "https://tg-birthday-bot.onrender.com/health")
          
          echo "üìä –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: $response_code"
          
          if [ "$response_code" = "200" ]; then
            echo "üéâ –£—Å–ø–µ—Ö! Render –ø—Ä–æ—Å–Ω—É–ª—Å—è –ø–æ—Å–ª–µ $attempt –ø–æ–ø—ã—Ç–∫–∏"
            echo "‚è∞ –í—Ä–µ–º—è —É—Å–ø–µ—Ö–∞: $(date)"
            exit 0
          else
            echo "üí§ Render –µ—â–µ —Å–ø–∏—Ç, –∂–¥–µ–º 15 —Å–µ–∫—É–Ω–¥..."
            sleep 15
          fi
        done
        
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–±—É–¥–∏—Ç—å Render –ø–æ—Å–ª–µ 6 –ø–æ–ø—ã—Ç–æ–∫"
        echo "‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è: $(date)"
        exit 1

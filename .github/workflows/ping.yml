name: Render Wake-up Service
on:
  schedule:
    - cron: '*/14 * * * *'  # –ö–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç (–≤–∞–∂–Ω–æ!)
  workflow_dispatch:

jobs:
  wake-render:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
    - name: Wake up Render with patience
      run: |
        echo "üïê –ù–∞—á–∏–Ω–∞–µ–º –±—É–¥–∏—Ç—å Render..."
        echo "‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞: $(date)"
        
        # –£–í–ï–õ–ò–ß–ò–ú –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏ —É–º–µ–Ω—å—à–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
        for attempt in {1..10}; do
          echo "üîî –ü–æ–ø—ã—Ç–∫–∞ $attempt –∏–∑ 10..."
          
          response_code=$(curl -s \
            -o /dev/null \
            -w "%{http_code}" \
            --max-time 30 \
            "https://tg-birthday-bot.onrender.com/health")
          
          echo "üìä –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: $response_code"
          
          if [ "$response_code" = "200" ]; then
            echo "üéâ –£—Å–ø–µ—Ö! Render –ø—Ä–æ—Å–Ω—É–ª—Å—è –ø–æ—Å–ª–µ $attempt –ø–æ–ø—ã—Ç–∫–∏"
            echo "‚è∞ –í—Ä–µ–º—è —É—Å–ø–µ—Ö–∞: $(date)"
            exit 0
          else
            echo "üí§ Render –µ—â–µ —Å–ø–∏—Ç, –∂–¥–µ–º 10 —Å–µ–∫—É–Ω–¥..."
            sleep 10  # –£–º–µ–Ω—å—à–∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª
          fi
        done
        
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–±—É–¥–∏—Ç—å Render –ø–æ—Å–ª–µ 10 –ø–æ–ø—ã—Ç–æ–∫"
        echo "‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è: $(date)"
        exit 1

# Отчет по миграции: Supabase -> Firebase Realtime Database

Этот файл содержит краткое описание всех изменений, внесенных в проект бота в ходе перехода на Firebase.

## 1. Технологический стек
- **База данных:** Перешли с реляционной Supabase (PostgreSQL) на NoSQL Firebase Realtime Database.
- **SDK:** Удален `@supabase/supabase-js`, добавлен `firebase-admin`.

## 2. Ключевые изменения в коде (`index.js`)
- **Инициализация:** Добавлена поддержка инициализации через `FIREBASE_KEY_BASE64` (в формате Base64 или чистого JSON) и `FIREBASE_DB_URL`.
- **Очистка данных:** Внедрена система удаления невидимых символов (BOM) из ключей, что исправляет ошибки при копировании из Windows.
- **DB Service:**
    - `upsertUser`: Теперь использует `db.ref('chats/chatID/userID').set()`.
    - `getUsersByChat`: Использует `.once('value')` для получения JSON-объекта чата.
- **Проверка дней рождений:** Логика адаптирована под иерархическую структуру Firebase: `chats -> chatId -> userId`.
- **Конфигурация:** Имя бота (`botUsername`) теперь берется из переменной окружения `BOT_USERNAME`, что делает его гибким.

## 3. Файлы и настройки
- **`.env`**:
    - Добавлены `FIREBASE_DB_URL`, `FIREBASE_KEY_BASE64`, `BOT_USERNAME`.
    - Удалены старые ключи Supabase.
- **`package.json`**: Обновлены зависимости и описание проекта.
- **`.gitignore`**: Добавлены исключения для секретов Firebase и папки `becap/`.
- **`firebase_import.json`**: Создан файл для первичного импорта существующих данных из Supabase в Firebase.

## 4. Меры безопасности
- Секретный JSON-файл Firebase больше не требуется хранить в репозитории; всё передается через защищенные переменные окружения Render.
- Код защищен от краха при ошибках инициализации (добавлен `process.exit(1)`).

---
*Миграция завершена 20.01.2026*
